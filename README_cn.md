[English](README.md) | [中文](README_cn.md)

# VCOM

一个极简的软件模拟串口驱动，串口数据在定时器中断内异步接收/发送。非常容易移植到不同MCU，只支持简单的波特率和检验位配置。

### 待办

- [X] 配置参数逻辑上的有效性检查
- [ ] 添加异步传输完成的回调接口

### 说明

/src 目录包含VCOM的源文件。

/interface 包含VCOM的必需配置和平台无关接口模板。

/test 包含VCOM的测试代码，用于检查配置的可行性和测试基本功能。

/example 包含VCOM的示例代码。

/project 包含运用到常用MCU开发板上的工程样例。所有工程基于VSCode IDE开发，使用CMake构建，并且通过GCC编译。

### 安装

参考 /interface 目录下与平台无关的模板，添加对应平台的GPIO和定时器驱动。

将 /src 目录和VCOM依赖的平台接口驱动，以及其他的驱动添加到您的工程。如果您想使用默认示例提供的功能，添加 /example 目录到您的工程中。

### 使用

您可以参考 /example 目录下的示例代码，了解VCOM的用法。但是请注意 `driver_vcom_init`使用的2个初始化参数的限制

- 串口波特率（`baudrate`）：VCOM会尽可能地在波特率定义的时间点发出/捕获信号，但是受定时器中断频率的限制，中断频率应该满足至少为波特率的4倍。
- 定时器中断频率（`timer_irq_freq`）：此参数直接传递给 `vcom_interface_timer_init`，`所以timer_irq_freq`的值受单片机定时器外设定时分辨率限制。尽管更高的中断频率通常可以实现更高的信号精度，但是频率太高可能导致其他系统任务无法获取足够的CPU时间，甚至定时器中断自身的排队。根据一般单片机的指令执行效率，中断频率需小于CPU频率的1/40。

由于不同MCU的GPIO翻转能力，CPU速度，指令效率的差异，建议在应用VCOM之前先运行位于 /test 目录下的测试用例确认配置参数的有效。

另外，/src 中的 `vcom_timer_handler` 函数应该放在对应的中断入口内。并且在 `vcom_interface_timer_init` 中配置一个较高的定时器中断优先级，确保信号操作不会被同一系统中的其他中断阻塞。如果您追求更高的波特率，就不应该通过间接回调运行中断函数，并尝试将中断放到RAM中运行。

### 贡献

欢迎BUG反馈和提交。VCOM是出于广泛适用和易于使用的目的构建，功能太复杂就脱离了目标，所以请在分叉后自行添加新功能。
